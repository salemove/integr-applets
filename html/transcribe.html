<!DOCTYPE html>
  <head>
    <title>webaudio demo</title>
  </head>
  <body>
    <div id="output-text"></div>
    <script>
      var recognition = new webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;

      function uuidv4() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
          var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
          return v.toString(16);
        });
      }

      const options = {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          Authorization: 'Bearer '
        },
        body: JSON.stringify({type: 'prompt'})
      };

      recognition.onresult = function (e) {
          var value = "";
          for (var i = e.resultIndex; i < e.results.length; ++i) {
              if (e.results[i].isFinal) {
                  value += e.results[i][0].transcript;
              }
          }
          if ( value != "") {
            console.log('Output text: ' + value.toString())
            var msgId = uuidv4();

            fetch(`https://api.salemove.com/engagements/engagement_id/chat_messages/${msgId}`, options)
              .then(response => response.json())
              .then(response => console.log(response))
              .catch(err => console.error(err));
            // document.getElementById('output-text').innerHTML = 'Output text: ' + value.toString();
          }
      }
      recognition.start();
    </script>
  </body>
</html>



const options = {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      Authorization: 'Bearer eyJhbGciOiJIUzUxMiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE2MTk2NTQzOTAsImlhdCI6MTYxOTY1MDc5MCwiaXNzIjoiU2FsZU1vdmUgT3BlcmF0b3IgQXV0aCIsInJvbGVzIjpbeyJvcGVyYXRvcl9pZCI6Ijc0YWZlZGQ5LWFlNWUtNDRhZS05ZWZkLWFmMWEzYWVlNDRhZiIsInR5cGUiOiJvcGVyYXRvciJ9LHsicm9sZSI6InN1cGVyX21hbmFnZXIiLCJzaXRlX2lkIjoiMjc0YmM1MDktNjNkMS00MzYxLThiY2YtYThmMzFkNTgzODUxIiwidHlwZSI6InNpdGVfb3BlcmF0b3IifSx7InJvbGUiOiJzdXBlcl9tYW5hZ2VyIiwic2l0ZV9pZCI6IjFhNjMwMTgwLTA5ODItNGQ5Mi1iNDU2LTc4NmZiZTAxNTc1ZSIsInR5cGUiOiJzaXRlX29wZXJhdG9yIn1dLCJzdWIiOiJvcGVyYXRvcjo3NGFmZWRkOS1hZTVlLTQ0YWUtOWVmZC1hZjFhM2FlZTQ0YWYifQ.M1DmkfsEkBiaaq7h4TMt1AD4I92-adlwaSOtp3Fz7NG3JMwecD7bM8HOvh_NNLqLUdxGEeCNMq-k2TON0oTvAg'
    },
    body: JSON.stringify({type: 'chat'})
};

fetch('https://api.salemove.com/engagements/engagement_id/chat_messages/message_id', options)
.then(response => response.json())
.then(response => console.log(response))
.catch(err => console.error(err));